<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  
      xmlns:h="http://java.sun.com/jsf/html"  
      xmlns:f="http://java.sun.com/jsf/core"  
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">  

    <h:head>  

        <f:facet name="last">
            <style type="text/css">
                .ui-panel .ui-panel-content {
                    padding: 0;
                }
                .weekDataTable {
                    display: block;
                    width: 1220px;
                    margin: 10px auto;
                }
                .dayDataTree {
                    width: 150px;
                    float: left;
                    margin: 10px;
                }
                .ui-cell-editor {
                    display: inline-block;
                }
                .scrollPanel {
                    max-width: 100%;
                    max-height: 600px;
                }
            </style>
        </f:facet>
    </h:head>  

    <h:body>
        <p:growl id="growl" globalOnly="true" autoUpdate="true" showSummary="true" showDetail="true"/>
        <h:form id="weekForm">

            <p:panel id="weekData" header="Series Calendar" styleClass="weekDataTable">

                <p:ring id="weekRing" value="#{mBWeekView.daysOfWeek}" var="dayOfWeek" easing="easeInOutBack">
                    <p:outputPanel style="text-align: center;" layout="block">
                        <div style="padding: 3px;">#{dayOfWeek.day}</div>
                        <p:commandButton update=":weekForm:dayDetail" action="#{mBUpdateDay.update}" icon="ui-icon-search" title="View" oncomplete="PF('dayDialog').show();">
                            <f:setPropertyActionListener value="#{dayOfWeek}" target="#{mBWeekView.selectedDay}" />
                        </p:commandButton>
                    </p:outputPanel>
                </p:ring>

                <p:dialog header="Day Info" widgetVar="dayDialog" modal="true" 
                          showEffect="fade" hideEffect="fade" resizable="true" 
                          width="700">
                    <p:dataTable id="dayDetail" value="#{mBDayView.seriesList}" var="series" 
                                 selectionMode="single" selection="#{mBDayView.selectedSeries}" rowKey="#{series.id}"
                                 editable="true" draggableRows="true"
                                 scrollable="true" scrollHeight="400">
                        <f:facet name="header">#{mBDayView.seriesDay}</f:facet>

                        <p:ajax event="rowEdit" listener="#{mBUpdateDay.onRowEdit}"/>
                        <p:ajax event="rowEditCancel"/>
                        <p:ajax event="rowReorder"/>

                        <p:column headerText="Edit" width="32">
                            <p:rowEditor />
                        </p:column>

                        <p:column sortBy="#{series.title}">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="#{series.title}" /></f:facet>
                                <f:facet name="input"><p:inputText value="#{series.title}" style="width:90%"/></f:facet>
                            </p:cellEditor>
                        </p:column>  

                        <p:column width="70" headerText="Torrent" style="text-align: center">
                            <p:button href="#{series.torrentLink}" target="_blank" icon="ui-icon-disk"/>
                        </p:column>

                        <p:column width="70" headerText="Subtitle" style="text-align: center">
                            <p:button href="#{series.subtitleLink}" target="_blank" icon="ui-icon-comment"/>
                        </p:column>

                        <f:facet name="footer">
                            <p:commandButton value="Add" icon="ui-icon-plus" update=":weekForm:dayDetail" actionListener="#{mBUpdateDay.add}"/>
                        </f:facet>
                    </p:dataTable>

                    <p:contextMenu for="dayDetail">
                        <p:submenu label="Move to:" icon="ui-icon-transferthick-e-w">
                            <p:menuitem value="Monday" icon="ui-icon-arrowthick-1-e" update=":weekForm:dayDetail" actionListener="#{mBUpdateDay.moveTo}">
                                <f:attribute name="dayTo" value="Monday"/>
                            </p:menuitem>
                            <p:menuitem value="Tuesday" icon="ui-icon-arrowthick-1-e" update=":weekForm:dayDetail" actionListener="#{mBUpdateDay.moveTo}">
                                <f:attribute name="dayTo" value="Tuesday"/>
                            </p:menuitem>
                            <p:menuitem value="Wednesday" icon="ui-icon-arrowthick-1-e" update=":weekForm:dayDetail" actionListener="#{mBUpdateDay.moveTo}">
                                <f:attribute name="dayTo" value="Wednesday"/>
                            </p:menuitem>
                            <p:menuitem value="Thursday" icon="ui-icon-arrowthick-1-e" update=":weekForm:dayDetail" actionListener="#{mBUpdateDay.moveTo}">
                                <f:attribute name="dayTo" value="Thursday"/>
                            </p:menuitem>
                            <p:menuitem value="Friday" icon="ui-icon-arrowthick-1-e" update=":weekForm:dayDetail" actionListener="#{mBUpdateDay.moveTo}">
                                <f:attribute name="dayTo" value="Friday"/>
                            </p:menuitem>
                            <p:menuitem value="Saturday" icon="ui-icon-arrowthick-1-e" update=":weekForm:dayDetail" actionListener="#{mBUpdateDay.moveTo}">
                                <f:attribute name="dayTo" value="Saturday"/>
                            </p:menuitem>
                            <p:menuitem value="Sunday" icon="ui-icon-arrowthick-1-e" update=":weekForm:dayDetail" actionListener="#{mBUpdateDay.moveTo}">
                                <f:attribute name="dayTo" value="Sunday"/>
                            </p:menuitem>
                        </p:submenu>
                        <p:menuitem value="Delete" icon="ui-icon-trash" update=":weekForm:dayDetail" actionListener="#{mBUpdateDay.delete}"/>
                    </p:contextMenu>

                </p:dialog>

                <div style="clear: both;"></div>
                <p:commandButton value="Update" actionListener="#{mBUpdateCalendar.info}" oncomplete="PF('fileUploadDialog').show();"/>
                <p:commandButton value="Clear" process="@this" update="weekData" action="#{mBUpdateCalendar.clear}" rendered="#{not empty mBWeekView.daysOfWeek}"/>

                <p:commandButton value="Export to xml" icon="ui-icon-arrowthick-1-s" ajax="false" 
                                 rendered="#{not empty mBWeekView.daysOfWeek}" style="float: right"
                                 onclick="PrimeFaces.monitorDownload(start, stop);">
                    <p:fileDownload value="#{mBSaveCalendar.export()}"/>
                </p:commandButton>

                <p:dialog modal="true" widgetVar="statusDialog" header="Status" draggable="false" closable="false" resizable="false">
                    <p:graphicImage library="images" name="ajaxloadingbar.gif"/>
                </p:dialog>

                <script type="text/javascript">
                    function start() {
                        PF('statusDialog').show();
                    }

                    function stop() {
                        PF('statusDialog').hide();
                    }
                </script>

                <p:dialog header="Upload" widgetVar="fileUploadDialog" modal="true" 
                          showEffect="fade" hideEffect="fade" resizable="true">
                    <p:fileUpload auto="true" allowTypes="/(\.|\/)(xml)$/" update="weekData" 
                                  fileUploadListener="#{mBUpdateCalendar.update}" 
                                  oncomplete="PF('fileUploadDialog').hide();"/>
                </p:dialog>


            </p:panel>

        </h:form>

    </h:body>  
</html> 
